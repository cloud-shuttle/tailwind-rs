# Pre-commit Hooks Setup

This document explains how to set up and use pre-commit hooks for the tailwind-rs project.

## Overview

Pre-commit hooks automatically run checks before each commit to ensure code quality and consistency. This project includes both traditional git hooks and modern pre-commit configuration.

## Files

- `.pre-commit-config.yaml` - Modern pre-commit configuration
- `.git/hooks/pre-commit` - Traditional git pre-commit hook
- `.git/hooks/commit-msg` - Traditional git commit message hook
- `.secrets.baseline` - Baseline for secret detection
- `.gitignore` - Git ignore patterns

## Quick Start

The hooks are already set up and will run automatically when you commit. No additional setup is required.

## What the Hooks Check

### Pre-commit Hook
1. **Tests**: Runs tests with `cargo nextest` (excluding broken framework crates)
2. **Formatting**: Checks code formatting with `cargo fmt`
3. **Linting**: Runs `cargo clippy` with strict warnings
4. **Documentation**: Ensures docs build successfully
5. **Large Files**: Warns about large files
6. **TODO/FIXME**: Warns about TODO/FIXME comments in staged files

### Commit Message Hook
- **Conventional Commits**: Enforces conventional commit message format
- **Format**: `type(scope): description`
- **Types**: feat, fix, docs, style, refactor, test, chore, ci, build, perf

## Manual Usage

### Run Pre-commit Checks Manually
```bash
# Run the pre-commit hook manually
.git/hooks/pre-commit

# Or run individual checks
cargo nextest run -p tailwind-rs-core -p tailwind-rs-macros -p tailwind-rs-testing
cargo fmt --all -- --check
cargo clippy -p tailwind-rs-core -p tailwind-rs-macros -p tailwind-rs-testing --all-targets --all-features -- -D warnings
cargo doc --no-deps
```

### Using Modern Pre-commit Tool
```bash
# Install pre-commit (if not already installed)
pip install pre-commit

# Install the git hook scripts
pre-commit install

# Run against all files
pre-commit run --all-files

# Run specific hook
pre-commit run clippy
```

## Troubleshooting

### Common Issues

1. **Formatting Errors**
   ```bash
   cargo fmt --all
   ```

2. **Clippy Warnings**
   - Fix the warnings or add `#[allow(clippy::warning_name)]` if appropriate
   - Common fixes:
     - Use `or_default()` instead of `or_insert_with(HashSet::new)`
     - Add `Default` implementations for structs with `new()` methods
     - Use `to_vec()` instead of `iter().cloned().collect()`

3. **Test Failures**
   - Ensure all tests pass before committing
   - Framework crates (Leptos, Yew, Dioxus) are currently excluded due to API mismatches

4. **Commit Message Format**
   - Use conventional commit format: `type(scope): description`
   - Examples:
     - `feat(core): add Color enum with intensity methods`
     - `fix(leptos): update ClassBuilder API calls`
     - `docs: update contributing guidelines`

### Bypassing Hooks

If you need to bypass the hooks (not recommended):

```bash
git commit --no-verify -m "your commit message"
```

## Configuration

### Excluding Framework Crates

Currently, the pre-commit hooks exclude the framework integration crates (`tailwind-rs-leptos`, `tailwind-rs-yew`, `tailwind-rs-dioxus`) due to API mismatches with current framework versions. Once these are fixed, the hooks can be updated to include them.

### Customizing Hooks

To modify the hooks:

1. **Traditional hooks**: Edit `.git/hooks/pre-commit` or `.git/hooks/commit-msg`
2. **Modern hooks**: Edit `.pre-commit-config.yaml`

### Adding New Checks

To add new checks to the pre-commit hook:

1. Add the check to `.git/hooks/pre-commit`
2. Add the check to `.pre-commit-config.yaml` if using the modern tool
3. Update this documentation

## Security

The hooks include secret detection to prevent accidental commits of sensitive information. The `.secrets.baseline` file contains known false positives.

## Performance

The hooks are optimized for speed:
- Tests run in parallel with `cargo nextest`
- Only changed files are checked where possible
- Framework crates are excluded to avoid compilation errors

## Contributing

When contributing to the pre-commit setup:

1. Test changes thoroughly
2. Update documentation
3. Ensure hooks work with both traditional and modern setups
4. Consider impact on development workflow
